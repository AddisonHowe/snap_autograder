<!DOCTYPE html>
<html>
    <head>
        <title>Snap! Build Your Own Blocks. Beta</title>
        <link rel="shortcut icon" href="http://snap.berkeley.edu/fav3.gif" type="image/gif">
        <script src="jschannel.js"></script>
        <script type="text/javascript" src="SnapPLE.js"></script>
        <script type="text/javascript" src="AGDrawSquare.js"></script>
        <script type="text/javascript" src="snap.js"></script>
        

        <script type="text/javascript">

            //recover stored save
            var pageXML = localStorage.getItem(id);
            var world;
            
            window.onload = function () {
                world = new WorldMorph(document.getElementById('world'));
                new IDE_Morph().openIn(world);

                //Reduce Stage Size on initialization
                var ide = world.children[0];
                ide.toggleStageSize(true);
                
                //If this page has already been loaded
                if (localStorage.getItem(id) !== null) {
                    ide.openProjectString(pageXML);
                }

                var hint = parent.document.getElementsByClassName("message")[0];
                var tags = 
                [['collapsedivstart', '<input class="toggle-box" id="expander" type="checkbox" ><label for="expander">Details</label><div id="table-wrapper">'], 
                ['collapsedivend', '</div>'], 
                ['linebreak', '<br /></br />'], 
                ['tablestart', '<table class="results">'], 
                ['tableend', '</table>'], 
                ['rowstart', '<tr>'], 
                ['rowend', '</tr>'], 
                ['headstart', '<th class="titles" style="text-align: center;">'], 
                ['headend', '</th>'], 
                ['datastart', '<td class="data" style="text-align: center;">'], 
                ['dataend', '</td>'], 
                ['correctstart', '<td class="correctans">'],
                ['incorrectstart', '<td class="incorrectans">'],
                ['teststart', '<td class="tests">'],
                ['spanend', '</span>'], 
                ['spanstart', '<span class="message">']];


                function escapeRegExp(string) {
                    return string.replace(/([.*+?^=!:${}()|\[\]\/\\])/g, "\\$1");
                }

                function replaceall(string, find, replace) {
                    return (string.replace(new RegExp(escapeRegExp(find), 'g'), replace));
                }

                var message = String(hint.innerHTML);
                var taglength = tags.length;

                for (var i = 0; i < taglength; i++) {
                    setTimeout(message = replaceall(message, tags[i][0], tags[i][1]), 300);
                }
                hint.innerHTML = message;

                setInterval(loop, 1);
            };
            function loop() {
                world.doOneCycle();
            }
        </script>
    </head>
    <body style="margin: 0;">
        <canvas id="world" tabindex="1" style="position: absolute;" ></canvas>
        <!-- <input id="clickMe" type="button" value="XXXXXX" onclick='multiTestBlock("%s my plus %s", [[1,2],[2,2],[2,3],[3,3]], [3,4,6,6]);'/> -->
        <div id="autograding" style="position: absolute; padding-top: 5px; padding-left: 5px; color:red;">
            UNGRADED
        </div>

    </body>
</html>
