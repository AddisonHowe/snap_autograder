<!DOCTYPE html>
<html>
    <head>
        <title>Snap! Build Your Own Blocks. Beta</title>
        <link rel="shortcut icon" href="http://snap.berkeley.edu/fav3.gif" type="image/gif">
        <script src="jschannel.js"></script>
        <script type="text/javascript" src="SnapPLE.js"></script>
        <script type="text/javascript" src="AG_M1_L1_T3.js"></script>
        <script type="text/javascript" src="snap.js"></script>
        

        <script type="text/javascript">

            //recover stored save
            console.log(id);
            var pageXML = localStorage.getItem(id);
            var world;
            
            window.onload = function () {

                //UPDATE GRADING FLAG
                var grade_flag = document.getElementById("autograding");
                var prev_AG_state = JSON.parse(localStorage.getItem(id + "answer"));
                console.log(prev_AG_state);
                if (prev_AG_state !== null) {
                    grade_flag.innerHTML = "GRADED";
                    if (prev_AG_state.checkState) {
                        grade_flag.style.color = "green";
                    } else {
                        grade_flag.style.color = "orange";
                    }
                } else {
                    grade_flag.innerHTML = "UNGRADED!";
                }

                //Check if Pre-requisite task has completed
                if (preReqID !== null &&
                    localStorage.getItem(preReqID + "answer") !== null) {
                    preReqState = JSON.parse(localStorage.getItem(preReqID + "answer"));
                    if (preReqState === null || !preReqState.checkState) {
                        var req_check = parent.document.getElementById("pre_req");
                        req_check.innerHTML = "WARNING: The previous task must be completed before continuing."
                    }
                }

                //INITIALIZE UP SNAP
                world = new WorldMorph(document.getElementById('world'));
                new IDE_Morph().openIn(world);

                //Reduce Stage Size on initialization
                var ide = world.children[0];
                ide.toggleStageSize(true);
                
                //If this page has already been loaded
                if (localStorage.getItem(id) !== null) {
                    ide.openProjectString(pageXML);
                }
                setInterval(loop, 1);
            };
            function loop() {
                world.doOneCycle();
            }
        </script>
        
    </head>
    <body style="margin: 0;">
        <canvas id="world" tabindex="1" style="position: absolute;" ></canvas>
        <!-- <input id="clickMe" type="button" value="XXXXXX" onclick='multiTestBlock("%s my plus %s", [[1,2],[2,2],[2,3],[3,3]], [3,4,6,6]);'/> -->
        <div id="autograding" style="position: absolute; padding-top: 5px; padding-left: 5px; color:red; font-family:helvetica">
            UNGRADED
        </div>

    </body>
</html>
